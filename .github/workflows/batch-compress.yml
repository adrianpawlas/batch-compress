name: Batch Image Compression

on:
  schedule:
    # Run every day at 12 PM UTC (noon)
    - cron: '0 12 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  compress-images:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 hours max (GitHub Actions limit)

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install dependencies
      run: npm install @supabase/supabase-js dotenv

    - name: Create .env file
      run: |
        echo "SUPABASE_URL=https://yqawmzggcgpeyaaynrjk.supabase.co" >> .env
        echo "SUPABASE_ANON_KEY=${{ secrets.SUPABASE_ANON_KEY }}" >> .env

    - name: Run batch compression
      run: node batch_compress.js
      env:
        SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
